DELIMITER $$

CREATE TRIGGER Manage_Navire_Doubles
AFTER INSERT
ON Navires FOR EACH ROW
BEGIN
  SET @count := 0;
  Select @count = Count(Matricule) from navires where Matricule = NEW.matricule;
  IF @count > 0
  	THEN
    	INSERT INTO Doubles(matricule, nom, portattache, categorie, scategorie, type, type_dem, date_immatriculation, quartier_maritime, armateur_id, created_at)
      Values (NEW.matricule, NEW.nom, NEW.portattache, NEW.categorie, NEW.scategorie, NEW.type, NEW.type_dem, NEW.date_immatriculation, NEW.quartier_maritime, NEW.armateur_id, Now());
        ROLLBACK;
    END IF;
END$$

DELIMITER;
############################################################################
DELIMITER $$

CREATE TRIGGER Manage_Navire_Doubles
AFTER INSERT
ON Navires FOR EACH ROW
BEGIN

  IF (Select Count(Matricule) from navires where Matricule = NEW.matricule) > 0
  	THEN

      IF (Select Count(Matricule) from doubles where Matricule = NEW.matricule) > 0
        THEN
          INSERT INTO Doubles(matricule, nom, portattache, categorie, scategorie, type, type_dem, date_immatriculation, quartier_maritime, armateur_id, created_at)
          Values (NEW.matricule, NEW.nom, NEW.portattache, NEW.categorie, NEW.scategorie, NEW.type, NEW.type_dem, NEW.date_immatriculation, NEW.quartier_maritime, NEW.armateur_id, Now());
      ELSE
        THEN
          Update Doubles SET count = count + 1
    END IF;
END$$
############################################################################
CREATE TRIGGER Manage_Navire_Doubles
AFTER INSERT
ON Navires FOR EACH ROW
  set @naviresCount = (Select Count(*) from navires where Matricule = NEW.matricule)
  IF @naviresCount > 0 THEN
    set @doublesCount = (Select Count(*) from doubles where Matricule = NEW.matricule)
    IF @doublesCount > 0 THEN
      Update Doubles SET `count` = `count` + 1 WHERE Matricule = NEW.matricule;
    ELSE
      INSERT INTO Doubles(`table`, matricule, nom, portattache, categorie, scategorie, type, type_dem, date_immatriculation, quartier_maritime, armateur_id, `count`, created_at)
        Values ('Navire', NEW.matricule, NEW.nom, NEW.portattache, NEW.categorie, NEW.scategorie, NEW.type, NEW.type_dem, NEW.date_immatriculation, NEW.quartier_maritime, NEW.armateur_id, 1, Now());
    END IF;
  END IF;
